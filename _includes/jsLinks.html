<!-- page-body div for fast page switching excluding scripts and css-->
	</div>
</div>

<!-- jQuery is required by Materialize to function -->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="{{ site.baseurl }}/js/materialize.min.js"></script>
<script type="text/javascript">
	
	//Reszing things based on screensize
	function sizes(){
		$("#docs-anchor").width( ( $("#docs-item-content").width() / 3 ) );
	}
	
	//init materialize stuff
	function materialInit(){
		$('.button-collapse').sideNav({closeOnClick: true});
		$('#docs-anchor').pushpin({
			top: 124,
			offset: 64
		});
		$('.collapsible').collapsible({
			accordion : true
		});
		$('.tooltipped').tooltip({delay: 50});
		// Set element sizes
		sizes();
	};
	
	//When initial page loads remove preloader
	$(document).ready(function(){
		materialInit();
		$("#preloader").fadeOut(600).hide();
		navTabs($("nav ul.desktop-navigation li.active a").attr("href"));
	});
	
	//Fix sizes on resize
	$(window).resize(function(){
		sizes();
	});
	
	
	// Page changing
	function getLocation() {
		return location.pathname + location.search;
	}
	
	//Vars
	var currentLocation = getLocation();
	var previousHistory = window.location.href;
	
	// Page changer
	function changePage(href){
		//Show the preloader
		$("#preloader").show();
		
		//Load content
		$('#page-body').load(href + " #page-body-inner", function(response, status, xhr){
			
			// Check for error
			if ( status == "error" ) {
				//For console
				console.log(xhr);
				//Show a toast with the error
				Materialize.toast("<span class='red-text'>Error! &nbsp;</span> (code: &nbsp; <b>" + xhr.status + "</b>)", 4000,"white primary-text");
				
				
				console.log(previousHistory);
				history.pushState(null, null, previousHistory);
			}
			
			// Re activate plugins
			materialInit()
			
			// Ditch loader and show page
			$("#preloader").hide();
			
			// Change active tab
			navTabs(href);
			
			// Animate scrolling back to the top
			$("html, body").animate({ scrollTop: 0 }, "slow");
			
		});
		
		//Load the title tag
		$('#title').load(href + " #title", "", function(data) {
			document.title = $(this).text();
		});
		
		// Set new current location
		currentLocation = getLocation();
	}
	// Link click
	$(document).on("click", ".internal-link", function(e){
		//Make sure the browser is new enough
		if (typeof(window.history.pushState) === typeof(Function)){
			
			//Show preloader
			$("#preloader").show();
			
			//Stop default changing page
			e.preventDefault();
			
			//Clicked link's href
			var href = $(this).attr("href");
			
			//Store the old history
			previousHistory = window.location.href;
			
			//set the history
			history.pushState(null, null, href);
			
			//Change the page contents
			changePage(href);
		}
	});
	
	// Browser back button
	window.onpopstate = function(e){
		
		//New loaction from back button
		var newLocation = getLocation();
		//Check the loaction has actually changed before acting on it
		if(newLocation != currentLocation) {
			// If yes, change the page
			changePage( location.pathname);
		}
	};
	
	// Contact form
	$(document).on("submit", "#contact-form", function(e){
		e.preventDefault();
		console.log($(this).serialize());
		$.ajax({
			url: "//formspree.io/irontiga@gmail.com",
			method: "POST",
			data: $(this).serialize(),
			dataType: "json",
			beforeSend: function() {
				$("#contact-loading").removeClass("hidden");
				$("#contact-submit").addClass("hidden");
			},
			success: function(data) {
				Materialize.toast('<b>Success!</b>', 4000,"white teal-text");
				$("contact-form").trigger("reset");
				$("#contact-loading").addClass("hidden");
				$("#contact-submit").removeClass("hidden");
			},
			error: function(err) {
				Materialize.toast('<b>Error!</b> &nbsp; Please check your submission', 4000,"white red-text");
				$("#contact-loading").addClass("hidden");
				$("#contact-submit").removeClass("hidden");
			}
		});
	});
	
	
	
	// Navbar underline
	function navTabs(href){
		
		var isTab = false;
		$("nav ul.desktop-navigation li a").each(function(){
			if(href.indexOf($(this).attr("href")) > -1){
				toActivate = $(this).parent();
				isTab = true;
				return false;
			}
		});
		if(!isTab || href == "/"){
			$(".active-indicator").css({
				"left" : 0,
				"width" : 0
			});
		}
		else{
			$("nav ul.desktop-navigation li.active").removeClass("active");
			toActivate.addClass("active");
			
			activateLi = $("nav ul.desktop-navigation li.active");

			$(".active-indicator").css({
				"left" : activateLi.position().left,
				"width" : activateLi.width()
			});
		}
	};
	
</script>